@startuml University Course Registration System
scale 0.75
skinparam classAttributeIconSize 0
skinparam classFontSize 10
skinparam defaultFontSize 9
skinparam packageFontSize 11
skinparam wrapWidth 150
skinparam nodesep 40
skinparam ranksep 30

title University Course Registration System - Class Diagram

' ==================== MODEL ====================
package "model" #DDDDDD {
    
    abstract class Person {
        -id: String
        -firstName: String
        -lastName: String
        -email: String
        +getId(): String
        +getFullName(): String
        +{abstract} role(): String
        +{abstract} displayProfile(): String
    }

    class Student {
        -major: String
        -year: int
        -transcript: Transcript
        -currentEnrollments: List<Enrollment>
        +getMajor(): String
        +getTranscript(): Transcript
        +addEnrollment(Enrollment): void
    }

    class Instructor {
        -department: String
        -officeNumber: String
        -assignedSections: List<Section>
        +getDepartment(): String
        +getAssignedSections(): List<Section>
        +addAssignedSection(Section): void
    }

    class Admin {
        +role(): String
    }

    class Course {
        -code: String
        -title: String
        -credits: int
        -prerequisites: List<String>
        +getCode(): String
        +getCredits(): int
        +getPrerequisites(): List<String>
        +matchesKeyword(String): boolean
    }

    class Section {
        -id: String
        -course: Course
        -term: String
        -instructor: Instructor
        -capacity: int
        -waitlistCapacity: int
        -meetingTimes: List<TimeSlot>
        -roster: List<Enrollment>
        +getId(): String
        +getCourse(): Course
        +getMeetingTimes(): List<TimeSlot>
        +isFull(): boolean
        +isWaitlistFull(): boolean
    }

    class Enrollment {
        -student: Student
        -section: Section
        -status: EnrollmentStatus
        -grade: Optional<Grade>
        +getStudent(): Student
        +getSection(): Section
        +getStatus(): EnrollmentStatus
        +assignGrade(Grade): void
        +hasGrade(): boolean
    }

    class Transcript {
        -student: Student
        -entries: List<TranscriptEntry>
        +getEntries(): List<TranscriptEntry>
        +getTotalCredits(): int
        +getGpa(): double
    }

    class TranscriptEntry {
        -section: Section
        -grade: Grade
        +getSection(): Section
        +getGrade(): Grade
        +getCredits(): int
        +getQualityPoints(): double
    }

    class TimeSlot <<value>> {
        -dayOfWeek: DayOfWeek
        -start: LocalTime
        -end: LocalTime
        -room: String
        +overlaps(TimeSlot): boolean
        +compareTo(TimeSlot): int
    }

    enum EnrollmentStatus {
        ENROLLED
        DROPPED
        WAITLISTED
    }

    enum Grade {
        A, B, C, D, F, I, W
        +getPoints(): double
        +countsTowardsGpa(): boolean
    }

    interface Schedulable {
        +getMeetingTimes(): List<TimeSlot>
    }

    interface Searchable {
        +matchesKeyword(String): boolean
    }

    interface Gradable {
        +assignGrade(Grade): void
        +getGrade(): Optional<Grade>
        +hasGrade(): boolean
    }
}

' ==================== SERVICE ====================
package "service" #AACCFF {
    
    interface RegistrationService {
        +enrollStudentInSection(String, String): Result<Enrollment>
        +dropStudentInSection(String, String): Result<Void>
        +getCurrentSchedule(String, String): Result<List<Section>>
        +getTranscript(String): Result<Transcript>
        +adminOverrideEnroll(String, String, String, String): Result<Enrollment>
    }

    interface CatalogService {
        +search(CourseQuery): Result<List<Course>>
        +createCourse(String, String, int): Result<Course>
        +createSection(String, Course, String, int): Result<Section>
        +assignInstructor(String, String): Result<Void>
        +getInstructorSections(String): Result<List<Section>>
        +adminOverrideCapacity(String, int, String, String): Result<Void>
    }

    interface GradingService {
        +postGrade(String, String, String, Grade): Result<Void>
        +computeGPA(String): Result<Double>
    }

    class RegistrationServiceImpl {
        -studentRepo: StudentRepository
        -sectionRepo: SectionRepository
        -enrollmentRepo: EnrollmentRepository
        -validator: PrerequisiteValidator
        -transcriptRepo: TranscriptRepository
        -personRepo: PersonRepository
        -logs: List<AdminOverrideLog>
    }

    class CatalogServiceImpl {
        -courseRepo: CourseRepository
        -sectionRepo: SectionRepository
        -personRepo: PersonRepository
        -logs: List<AdminOverrideLog>
    }

    class GradingServiceImpl {
        -studentRepo: StudentRepository
        -sectionRepo: SectionRepository
        -enrollmentRepo: EnrollmentRepository
        -transcriptRepo: TranscriptRepository
    }
}

' ==================== VALIDATION ====================
package "validation" #FFCCCC {
    
    class PrerequisiteValidator {
        +hasCompletedPrerequisites(Transcript, Course): boolean
        +hasCompletedPrerequisites(Transcript, Course, boolean): boolean
    }

    class CapacityValidator {
        +hasCapacity(Section): boolean
        +hasWaitlistCapacity(Section): boolean
    }

    class ScheduleConflictChecker {
        +conflicts(Schedulable, Schedulable): boolean
    }
}

' ==================== REPOSITORY ====================
package "repository" #CCFFCC {
    
    interface "Repository<T,ID>" as Repository {
        +findById(ID): Optional<T>
        +findAll(): List<T>
        +save(T): T
        +deleteById(ID): void
    }

    class CourseRepository {
        -store: Map<String, Course>
    }
    class SectionRepository {
        -store: Map<String, Section>
    }
    class StudentRepository {
        -store: Map<String, Student>
    }
    class PersonRepository {
        -store: Map<String, Person>
    }
    class EnrollmentRepository {
        -store: Map<String, Enrollment>
        +findByStudent(String): List<Enrollment>
        +findByStudentAndSection(Student, Section): Optional<Enrollment>
    }
    class TranscriptRepository {
        -store: Map<String, Transcript>
    }
}

' ==================== UTIL ====================
package "util" #FFFFCC {
    
    class "Result<T>" as Result {
        -value: T
        -error: String
        +{static} ok(T): Result<T>
        +{static} fail(String): Result<T>
        +isOk(): boolean
        +isFail(): boolean
        +get(): T
        +getError(): String
    }

    interface "Specification<T>" as Specification {
        +isSatisfiedBy(T): boolean
    }

    class CourseQuery {
        -code: String
        -title: String
        -minCredits: Integer
        -maxCredits: Integer
        -instructorName: String
        -dayOfWeek: DayOfWeek
        -startTime: LocalTime
        -endTime: LocalTime
        +isSatisfiedBy(Course): boolean
    }

    class AdminOverrideLog {
        -adminId: String
        -action: String
        -targetId: String
        -reason: String
        -timestamp: LocalDateTime
    }
}

' ==================== CLI / GUI ====================
package "ui" #EEDDFF {
    class CommandLineInterface {
        -registrationService: RegistrationService
        -catalogService: CatalogService
        -gradingService: GradingService
        -currentUserId: String
        -currentUserRole: String
        +start(): void
    }

    class SimpleGui {
        -registrationService: RegistrationService
        -catalogService: CatalogService
        -gradingService: GradingService
        +start(): void
    }
}

' ==================== INHERITANCE ====================
Person <|-- Student
Person <|-- Instructor
Person <|-- Admin

' ==================== INTERFACE IMPL ====================
Section ..|> Schedulable
Course ..|> Searchable
Enrollment ..|> Gradable

CourseQuery ..|> Specification

RegistrationServiceImpl ..|> RegistrationService
CatalogServiceImpl ..|> CatalogService
GradingServiceImpl ..|> GradingService

CourseRepository ..|> Repository
SectionRepository ..|> Repository
StudentRepository ..|> Repository
PersonRepository ..|> Repository
EnrollmentRepository ..|> Repository
TranscriptRepository ..|> Repository

' ==================== MODEL ASSOCIATIONS ====================
Course "1" *-- "*" Section : contains
Section "*" o-- "*" Enrollment : roster
Section "*" o-- "*" TimeSlot : meetingTimes
Section "*" o-- "0..1" Instructor : assignedTo
Student "1" *-- "1" Transcript : has
Transcript "1" *-- "*" TranscriptEntry : entries
Enrollment "*" --> "1" Student : student
Enrollment "*" --> "1" Section : section
TranscriptEntry "*" --> "1" Section : section
Enrollment "*" --> "0..1" Grade : grade
TranscriptEntry "*" --> "1" Grade : grade
Enrollment "*" --> "1" EnrollmentStatus : status

' ==================== SERVICE DEPENDENCIES ====================
RegistrationServiceImpl --> StudentRepository : uses
RegistrationServiceImpl --> SectionRepository : uses
RegistrationServiceImpl --> EnrollmentRepository : uses
RegistrationServiceImpl --> TranscriptRepository : uses
RegistrationServiceImpl --> PersonRepository : uses
RegistrationServiceImpl --> PrerequisiteValidator : uses
RegistrationServiceImpl --> AdminOverrideLog : logs

CatalogServiceImpl --> CourseRepository : uses
CatalogServiceImpl --> SectionRepository : uses
CatalogServiceImpl --> PersonRepository : uses
CatalogServiceImpl --> AdminOverrideLog : logs

GradingServiceImpl --> StudentRepository : uses
GradingServiceImpl --> SectionRepository : uses
GradingServiceImpl --> EnrollmentRepository : uses
GradingServiceImpl --> TranscriptRepository : uses

' ==================== VALIDATION DEPENDENCIES ====================
ScheduleConflictChecker ..> Schedulable : checks
ScheduleConflictChecker ..> TimeSlot : uses
PrerequisiteValidator ..> Transcript : validates
PrerequisiteValidator ..> Course : validates
CapacityValidator ..> Section : validates

' ==================== UI DEPENDENCIES ====================
CommandLineInterface --> RegistrationService : uses
CommandLineInterface --> CatalogService : uses
CommandLineInterface --> GradingService : uses

SimpleGui --> RegistrationService : uses
SimpleGui --> CatalogService : uses
SimpleGui --> GradingService : uses

' ==================== RESULT USAGE ====================
RegistrationService ..> Result : returns
CatalogService ..> Result : returns
GradingService ..> Result : returns
CatalogService ..> CourseQuery : uses

@enduml
